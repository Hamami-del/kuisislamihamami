<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kuis Islami • By Hamami</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1: #e6f3ff;
    --bg2: #dff2ff;
    --primary: #1976d2;
    --accent: #0288d1;
    --success: #2e7d32;
    --danger: #c62828;
    --card: #ffffff;
    --glass: rgba(255,255,255,0.6);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:'Poppins',sans-serif;
    background: linear-gradient(180deg,var(--bg1),var(--bg2));
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
  }
  .app {
    width:95%;
    max-width:700px;
    background: linear-gradient(180deg, rgba(255,255,255,0.95), var(--card));
    border-radius:18px;
    box-shadow: 0 10px 30px rgba(16,78,122,0.12);
    padding:20px;
    position:relative;
    overflow:hidden;
  }
  header {
    display:flex;
    align-items:center;
    gap:12px;
    margin-bottom:6px;
  }
  .logo {
    width:56px;
    height:56px;
    border-radius:12px;
    background: linear-gradient(135deg,var(--primary),var(--accent));
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-weight:700;
    font-size:20px;
    box-shadow: 0 6px 18px rgba(3,57,108,0.12), inset 0 -6px 12px rgba(255,255,255,0.08);
  }
  h1{font-size:18px;margin:0;color:var(--primary)}
  p.lead{margin:0;font-size:13px;color:#1769aa8a}
  .meta {
    display:flex;
    gap:8px;
    margin-top:12px;
    align-items:center;
    justify-content:space-between;
  }
  .controls{
    display:flex;
    gap:8px;
    align-items:center;
  }
  select, input[type="text"]{
    padding:8px 10px;
    border-radius:10px;
    border:1px solid rgba(3,57,108,0.08);
    font-size:14px;
    outline:none;
    min-width:120px;
    background:var(--glass);
  }
  button {
    background:var(--primary);
    color:white;
    border:none;
    padding:9px 14px;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
    box-shadow: 0 8px 16px rgba(3,57,108,0.08);
  }
  button.secondary{
    background:transparent;
    color:var(--primary);
    border:1px solid rgba(3,57,108,0.08);
    box-shadow:none;
  }
  .card {
    margin-top:16px;
    background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.85));
    padding:18px;
    border-radius:12px;
    border:1px solid rgba(3,57,108,0.04);
    min-height:150px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    position:relative;
  }
  .question{
    font-size:18px;
    color:#044f9a;
    font-weight:600;
    margin-bottom:12px;
    text-align:center;
  }
  .answerRow{
    display:flex;
    gap:8px;
    align-items:center;
    justify-content:center;
    width:100%;
  }
  .result {
    margin-top:12px;
    font-weight:700;
    min-height:26px;
    transition:all .25s ease;
  }
  .flash-success { animation: flashSuccess .9s ease both; }
  .flash-wrong { animation: flashWrong .9s ease both; }
  @keyframes flashSuccess {
    0%{ transform: translateY(0); box-shadow: none; }
    20%{ transform: translateY(-6px) scale(1.02); box-shadow: 0 20px 40px rgba(46,125,50,0.08);}
    100%{ transform: translateY(0); box-shadow:none;}
  }
  @keyframes flashWrong {
    0%{ transform: rotate(0deg) }
    20%{ transform: rotate(-2deg) }
    40%{ transform: rotate(2deg) }
    60%{ transform: rotate(-1deg) }
    100%{ transform: rotate(0deg) }
  }
  .scorebar{
    display:flex;
    gap:8px;
    align-items:center;
    justify-content:space-between;
    margin-top:14px;
    width:100%;
  }
  .small{font-size:12px;color:#1769aa8a}
  .modal {
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background: rgba(3,57,108,0.35);
    z-index:40;
  }
  .modal.show{display:flex}
  .modalCard{
    width:95%;
    max-width:420px;
    background:white;
    border-radius:12px;
    padding:16px;
    box-shadow:0 30px 70px rgba(3,57,108,0.18);
  }
  .payOptions {display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .payRow{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;border:1px dashed rgba(3,57,108,0.06)}
  .note{font-size:13px;color:#1769aa}
  footer{
    margin-top:12px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  .byline{font-size:12px;color:#1769aa8a}
  @media (max-width:520px){
    .answerRow{flex-direction:column}
    select{width:100%}
  }
  .confetti {
    position:absolute;
    pointer-events:none;
    inset:0;
  }
  .confetti span{
    position:absolute;
    width:10px;height:10px;
    border-radius:50%;
    opacity:0.95;
    animation: fall 1.6s linear forwards;
  }
  @keyframes fall{
    to { transform: translateY(140px) rotate(200deg); opacity:0; }
  }
</style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="logo">H</div>
      <div>
        <h1>Kuis Islami • Hamami</h1>
        <p class="lead">Belajar sambil bermain — versi profesional </p>
      </div>
    </header>

    <div class="meta">
      <div class="controls">
        <select id="level">
          <option value="easy">Mudah</option>
          <option value="medium" selected>Sedang</option>
          <option value="hard">Sulit</option>
        </select>

        <input id="playerName" type="text" placeholder="Nama Kamu (opsional)" style="min-width:200px" />
        <button id="startBtn">Mulai</button>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <div class="small">Skor: <span id="scoreView">0</span></div>
        <button id="payBtn" class="secondary">Bayar Seiklasnya</button>
      </div>
    </div>

    <div class="card" id="card">
      <div class="question" id="question">Klik "Mulai" untuk memulai kuis.</div>

      <div class="answerRow" id="answerRow" style="display:none">
        <input id="answer" type="text" placeholder="Tulis jawabanmu..." />
        <button id="submitBtn">Jawab</button>
      </div>

      <div class="result" id="result"></div>

      <div class="scorebar" id="scorebar" style="display:none">
        <div class="small" id="progressText"></div>
        <div class="small" id="tips">Tip: kamu bisa jawab meski ada sedikit salah ketik.</div>
      </div>

      <div class="confetti" id="confetti"></div>
    </div>

    <footer>
      <div class="byline">Versi Premium • Siap dijual</div>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="resetBtn" class="secondary">Reset</button>
      </div>
    </footer>
  </div>

  <div class="modal" id="payModal" aria-hidden="true">
    <div class="modalCard">
      <h3>Bayar Seikhlasnya • Dukung karya Hamami</h3>
      <p class="note">Jika kamu suka game ini, boleh bayar seikhlasnya agar Hamami bisa terus membuat konten edukasi Islami.</p>

      <div class="payOptions">
        <div class="payRow">
          <div>Via Dana/OVO/GoPay</div>
          <div><span id="eWallet">0855-4526-0449</span></div>
        </div>
        <div class="payRow">
          <div>Atau bayar seikhlasnya</div>
          <div><button id="paidBtn">Saya Sudah Bayar</button></div>
        </div>
      </div>

      <p style="margin-top:10px;font-size:13px;color:#1769aa8a">Setelah membayar, klik "Saya Sudah Bayar" untuk menandai sebagai didukung.</p>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button id="closePay" class="secondary">Tutup</button>
      </div>
    </div>
  </div>

  <!-- Background music & effects -->
  <audio id="bgMusic" loop preload="auto">
    <source src="https://cdn.pixabay.com/download/audio/2024/07/09/audio_ed9df3f032.mp3?filename=islamic-music-no-copyright-copyright-free-islamic-background-music-223062.mp3" type="audio/mp3">
  </audio>
  <audio id="sndCorrect" preload="auto">
    <source src="https://cdn.pixabay.com/download/audio/2024/02/26/audio_cfc55c2a33.mp3?filename=shine-193240.mp3" type="audio/mp3">
  </audio>
  <audio id="sndWrong" preload="auto">
    <source src="https://cdn.pixabay.com/download/audio/2024/03/31/audio_90a0db4b4c.mp3?filename=error-04-199275.mp3" type="audio/mp3">
  </audio>

<script>
/* =========================
   Data soal per tingkat (50 per level sesuai permintaan)
   ========================= */
const data = {
  easy: [
    {q:"Kitab suci umat Islam?", a:"Al-Qur'an"},
    {q:"Bulan puasa?", a:"Ramadhan"},
    {q:"Rukun Islam berapa?", a:"5"},
    {q:"Arah kiblat?", a:"Ka'bah"},
    {q:"Puasa Ramadhan hukumnya?", a:"Wajib"},
    {q:"Shalat wajib sehari semalam berapa?", a:"5"},
    {q:"Hari raya umat Islam setelah Ramadhan?", a:"Idul Fitri"},
    {q:"Nama Nabi yang terakhir?", a:"Muhammad"},
    {q:"Malaikat yang menyampaikan wahyu?", a:"Jibril"},
    {q:"Ibadah haji dilakukan di kota?", a:"Mekah"},
    {q:"Hari raya kurban disebut?", a:"Idul Adha"},
    {q:"Puasa sunnah sebelum Idul Fitri?", a:"Syawal"},
    {q:"Puasa hari Senin dan Kamis sunnah siapa?", a:"Rasulullah"},
    {q:"Rukun iman pertama?", a:"Iman kepada Allah"},
    {q:"Rukun iman kedua?", a:"Iman kepada Malaikat"},
    {q:"Rukun iman ketiga?", a:"Iman kepada Kitab"},
    {q:"Rukun iman keempat?", a:"Iman kepada Rasul"},
    {q:"Rukun iman kelima?", a:"Iman kepada Hari Kiamat"},
    {q:"Shalat Jumat dilakukan setiap?", a:"Jumat"},
    {q:"Nama istri Nabi Muhammad pertama?", a:"Khadijah"},
    {q:"Tempat Nabi Muhammad lahir?", a:"Mekah"},
    {q:"Puasa di bulan Dzulhijjah disebut?", a:"Arafah"},
    {q:"Puasa Ramadhan dimulai dari?", a:"Bulan Ramadhan"},
    {q:"Shalat Subuh terdiri dari berapa rakaat?", a:"2"},
    {q:"Shalat Dzuhur berapa rakaat?", a:"4"},
    {q:"Shalat Ashar berapa rakaat?", a:"4"},
    {q:"Shalat Maghrib berapa rakaat?", a:"3"},
    {q:"Shalat Isya berapa rakaat?", a:"4"},
    {q:"Doa sebelum tidur sunnah siapa?", a:"Rasulullah"},
    {q:"Puasa sunnah Senin dan Kamis untuk siapa?", a:"Umat Islam"},
    {q:"Nama Nabi yang dibakar tetapi selamat?", a:"Ibrahim"},
    {q:"Kota hijrah Nabi Muhammad?", a:"Madinah"},
    {q:"Shalat Tarawih dilakukan pada bulan?", a:"Ramadhan"},
    {q:"Zakat fitrah wajib dibayarkan sebelum?", a:"Idul Fitri"},
    {q:"Rukun haji pertama?", a:"Ihram"},
    {q:"Rukun haji kedua?", a:"Wukuf di Arafah"},
    {q:"Rukun haji ketiga?", a:"Thawaf"},
    {q:"Rukun haji keempat?", a:"Sai'i"},
    {q:"Rukun haji kelima?", a:"Tahallul"},
    {q:"Puasa sunnah hari Asyura tanggal berapa?", a:"10 Muharram"},
    {q:"Puasa sunnah Nabi Daud sehari?", a:"Sehari puasa, sehari tidak"},
    {q:"Nama Nabi yang menerima Taurat?", a:"Musa"},
    {q:"Nama Nabi yang menerima Injil?", a:"Isa"},
    {q:"Kitab terakhir yang diturunkan?", a:"Al-Qur'an"},
    {q:"Hari Jumat doa khusus sunnah siapa?", a:"Rasulullah"},
    {q:"Shalat witir berapa rakaat minimal?", a:"1"},
    {q:"Nabi yang terkenal sabar?", a:"Ayyub"},
    {q:"Nabi yang dibawa ke langit tanpa wafat?", a:"Isa"},
    {q:"Hari kemenangan umat Islam?", a:"Idul Fitri"},
    {q:"Hari pengorbanan umat Islam?", a:"Idul Adha"},
    {q:"Doa bangun tidur sunnah siapa?", a:"Rasulullah"},
    {q:"Nama surah pembuka Al-Qur'an?", a:"Al-Fatihah"},
    {q:"Nama surah terpanjang?", a:"Al-Baqarah"},
    {q:"Nama surah terakhir?", a:"An-Nas"}
  ],

  medium: [
    {q:"Jumlah rakaat shalat sunnah Rawatib sebelum Dzuhur?", a:"4"},
    {q:"Nama ayah Nabi Muhammad?", a:"Abdullah"},
    {q:"Surah pertama yang diturunkan?", a:"Al-'Alaq"},
    {q:"Nabi yang dibakar tetapi selamat?", a:"Ibrahim"},
    {q:"Kapan Isra' Mi'raj terjadi?", a:"Malam"},
    {q:"Hari Asyura jatuh pada tanggal?", a:"10 Muharram"},
    {q:"Nama istri Nabi Muhammad yang pertama?", a:"Khadijah"},
    {q:"Nama malaikat pencatat amal?", a:"Raqib dan Atid"},
    {q:"Lima rukun iman?", a:"Iman kepada Allah, Malaikat, Kitab, Rasul, Hari Kiamat"},
    {q:"Zakat fitrah diberikan sebelum?", a:"Idul Fitri"},
    {q:"Jumlah rukun Islam?", a:"5"},
    {q:"Puasa wajib dilakukan bulan?", a:"Ramadhan"},
    {q:"Shalat sunnah duha minimal rakaat?", a:"2"},
    {q:"Nama Nabi yang membelah laut?", a:"Musa"},
    {q:"Siapa yang menerima wahyu pertama?", a:"Muhammad"},
    {q:"Nama surah yang berisi 255 ayat?", a:"Al-Baqarah"},
    {q:"Rukun haji yang wajib?", a:"Ihram, Wukuf, Thawaf, Sai'i, Tahallul"},
    {q:"Nabi yang dibawa ke langit tanpa wafat?", a:"Isa"},
    {q:"Nama anak Nabi Ibrahim yang terkenal?", a:"Ismail"},
    {q:"Nama istri Nabi Ibrahim yang sabar?", a:"Hajar"},
    {q:"Surah terakhir yang diturunkan?", a:"An-Nas"},
    {q:"Nama Nabi yang terkenal bijaksana?", a:"Sulaiman"},
    {q:"Nabi yang terkenal sabar dalam kesulitan?", a:"Ayyub"},
    {q:"Nama Nabi yang dibunuh oleh kaumnya?", a:"Yunus"},
    {q:"Nama Nabi yang menerima Zabur?", a:"Daud"},
    {q:"Rukun shalat?", a:"Berdiri, Takbir, Ruku, Sujud, Duduk, Salam"},
    {q:"Hari Jumat wajib shalat?", a:"Jumat"},
    {q:"Nabi yang terkenal kedermawanan?", a:"Muhammad"},
    {q:"Puasa sunnah bulan Muharram disebut?", a:"Asyura"},
    {q:"Nama istri Nabi Yusuf?", a:"Zulaikha"},
    {q:"Jumlah ayat Al-Fatihah?", a:"7"},
    {q:"Nama Nabi yang terkenal di Mesir?", a:"Yusuf"},
    {q:"Nama Nabi yang membangun bahtera?", a:"Nuh"},
    {q:"Surah paling pendek?", a:"Al-Kautsar"},
    {q:"Shalat witir berapa rakaat minimal?", a:"1"},
    {q:"Zakat mal diberikan setiap?", a:"Setahun sekali"},
    {q:"Nama malaikat pembawa wahyu?", a:"Jibril"},
    {q:"Nama malaikat pencabut nyawa?", a:"Izrail"},
    {q:"Nama malaikat penjaga surga?", a:"Mikail"},
    {q:"Nama malaikat penjaga neraka?", a:"Raqib dan Atid"},
    {q:"Nama Nabi yang berdoa di Gua Hira?", a:"Muhammad"},
    {q:"Nama Nabi yang terkenal menundukkan Raja?", a:"Sulaiman"},
    {q:"Nama Nabi yang terkenal sabar menunggu janji Tuhan?", a:"Ayub"},
    {q:"Nama Nabi yang terkenal berdoa agar kaumnya selamat?", a:"Nuh"},
    {q:"Jumlah nabi yang disebut dalam Al-Qur'an?", a:"25"},
    {q:"Nabi yang dikenal dengan mukjizat tongkat?", a:"Musa"},
    {q:"Hari kemenangan umat Islam?", a:"Idul Fitri"},
    {q:"Hari pengorbanan umat Islam?", a:"Idul Adha"},
    {q:"Shalat tarawih dilakukan berapa rakaat?", a:"20"}
  ],

  hard: [
    {q:"Nama lengkap Nabi Muhammad ﷺ?", a:"Muhammad bin Abdullah"},
    {q:"Dimana Nabi Muhammad menerima wahyu pertama?", a:"Gua Hira"},
    {q:"Kitab diturunkan kepada Nabi Isa AS?", a:"Injil"},
    {q:"Jumlah Asmaul Husna?", a:"99"},
    {q:"Nama ayah Nabi Ibrahim AS?", a:"Azar"},
    {q:"Siapakah Khalifah kedua?", a:"Umar"},
    {q:"Kota kelahiran Nabi Muhammad?", a:"Mekah"},
    {q:"Surah terpanjang dalam Al-Qur'an?", a:"Al-Baqarah"},
    {q:"Puasa hari Senin dan Kamis termasuk sunnah siapa?", a:"Rasulullah"},
    {q:"Nabi yang terkenal dengan mukjizat tongkat?", a:"Musa"},
    {q:"Nabi yang menyelematkan kaumnya dari banjir besar?", a:"Nuh"},
    {q:"Nabi yang menerima kitab Taurat?", a:"Musa"},
    {q:"Nabi yang menerima kitab Zabur?", a:"Daud"},
    {q:"Nabi yang menerima kitab Injil?", a:"Isa"},
    {q:"Nabi yang menerima Al-Qur'an?", a:"Muhammad"},
    {q:"Nama istri Nabi Muhammad yang terkenal alim?", a:"Aisyah"},
    {q:"Nama istri Nabi Muhammad yang pertama?", a:"Khadijah"},
    {q:"Nama istri Nabi Nuh?", a:"Naamah"},
    {q:"Nabi yang terkenal dengan kesabarannya?", a:"Ayub"},
    {q:"Nabi yang dibawa ke langit tanpa wafat?", a:"Isa"},
    {q:"Jumlah rakaat shalat sunnah rawatib sebelum dan sesudah Dzuhur?", a:"4+2"},
    {q:"Jumlah rakaat shalat sunnah rawatib sebelum dan sesudah Maghrib?", a:"2+2"},
    {q:"Rukun haji wajib berapa?", a:"5"},
    {q:"Nama Nabi yang membelah laut?", a:"Musa"},
    {q:"Nama Nabi yang terkenal bijaksana dan adil?", a:"Sulaiman"},
    {q:"Nama Nabi yang terkenal dengan kesabaran?", a:"Ayub"},
    {q:"Nama Nabi yang dikenal dermawan?", a:"Muhammad"},
    {q:"Surah yang dibaca saat shalat?", a:"Al-Fatihah"},
    {q:"Jumlah ayat Al-Fatihah?", a:"7"},
    {q:"Nama surah terakhir diturunkan?", a:"An-Nas"},
    {q:"Nama surah paling pendek?", a:"Al-Kautsar"},
    {q:"Nama Nabi yang membangun bahtera?", a:"Nuh"},
    {q:"Nama Nabi yang dikenal di Mesir?", a:"Yusuf"},
    {q:"Nama Nabi yang terkenal menundukkan Raja?", a:"Sulaiman"},
    {q:"Nabi yang berdoa agar kaumnya selamat?", a:"Nuh"},
    {q:"Nama malaikat pencatat amal baik?", a:"Raqib"},
    {q:"Nama malaikat pencatat amal buruk?", a:"Atid"},
    {q:"Nama malaikat penjaga surga?", a:"Mikail"},
    {q:"Nama malaikat penjaga neraka?", a:"Izrail"},
    {q:"Jumlah nabi yang disebut dalam Al-Qur'an?", a:"25"},
    {q:"Hari kemenangan umat Islam?", a:"Idul Fitri"},
    {q:"Hari pengorbanan umat Islam?", a:"Idul Adha"},
    {q:"Puasa wajib?", a:"Ramadhan"},
    {q:"Shalat wajib sehari semalam?", a:"5"},
    {q:"Zakat mal diberikan setiap?", a:"Setahun sekali"},
    {q:"Nama Nabi yang terkenal dengan mukjizat tongkat?", a:"Musa"},
    {q:"Surah paling panjang?", a:"Al-Baqarah"},
    {q:"Nama Nabi yang menerima Al-Qur'an?", a:"Muhammad"},
    {q:"Nabi yang dikenal dermawan?", a:"Muhammad"},
    {q:"Nabi yang terkenal sabar menghadapi cobaan?", a:"Ayub"},
    {q:"Nabi yang terkenal bijaksana?", a:"Sulaiman"}
  ]
};

/* ====== State ====== */
let questions = [];
let idx = 0;
let score = 0;
let playerName = '';
let supported = false;
let acceptingAnswer = true; // prevent double submits

/* ====== Elements ====== */
const startBtn = document.getElementById('startBtn');
const levelSelect = document.getElementById('level');
const playerNameInput = document.getElementById('playerName');
const questionEl = document.getElementById('question');
const answerRow = document.getElementById('answerRow');
const answerInput = document.getElementById('answer');
const submitBtn = document.getElementById('submitBtn');
const resultEl = document.getElementById('result');
const scoreView = document.getElementById('scoreView');
const scorebar = document.getElementById('scorebar');
const progressText = document.getElementById('progressText');
const confetti = document.getElementById('confetti');
const card = document.getElementById('card');

const bgMusic = document.getElementById('bgMusic');
const sndCorrect = document.getElementById('sndCorrect');
const sndWrong = document.getElementById('sndWrong');

const payBtn = document.getElementById('payBtn');
const payModal = document.getElementById('payModal');
const closePay = document.getElementById('closePay');
const paidBtn = document.getElementById('paidBtn');
const eWallet = document.getElementById('eWallet');

eWallet.textContent = "0855-4526-0449";

/* ============================
   Utility: Levenshtein similarity
   ============================ */
function similarity(a,b){
  a = a || ''; b = b || '';
  a = a.toLowerCase(); b = b.toLowerCase();
  const al = a.length, bl = b.length;
  if(al===0 && bl===0) return 1;
  if(al===0 || bl===0) return 0;
  const m = Array.from({length:bl+1}, (_,i)=> Array(al+1).fill(0));
  for(let i=0;i<=bl;i++) m[i][0]=i;
  for(let j=0;j<=al;j++) m[0][j]=j;
  for(let i=1;i<=bl;i++){
    for(let j=1;j<=al;j++){
      const cost = b.charAt(i-1) === a.charAt(j-1) ? 0 : 1;
      m[i][j] = Math.min(
        m[i-1][j]+1,
        m[i][j-1]+1,
        m[i-1][j-1]+cost
      );
    }
  }
  const dist = m[bl][al];
  const maxLen = Math.max(al,bl) || 1;
  return 1 - dist/maxLen;
}

/* ============================
   Start game
   ============================ */
startBtn.addEventListener('click', startGame);

function startGame(){
  const lvl = levelSelect.value;
  // copy and shuffle the chosen level questions
  questions = shuffleArray([...data[lvl]]);
  idx = 0; score = 0;
  playerName = playerNameInput.value.trim();
  acceptingAnswer = true;

  // show UI
  answerRow.style.display = 'flex';
  scorebar.style.display = 'flex';
  updateScore();
  showQuestion();

  // ensure music plays on user gesture
  try{ bgMusic.volume = 0.38; bgMusic.play().catch(()=>{}); }catch(e){}
}

/* submit flow */
submitBtn.addEventListener('click', ()=>{ if(acceptingAnswer) checkAnswer(); });
answerInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' && acceptingAnswer) checkAnswer(); });

function showQuestion(){
  if(idx >= questions.length){
    endGame();
    return;
  }
  const q = questions[idx];
  questionEl.textContent = `❓ ${q.q}`;
  answerInput.value = '';
  answerInput.focus();
  progressText.textContent = `Soal ${idx+1} dari ${questions.length}`;
  resultEl.textContent = '';
  acceptingAnswer = true;
}

/* check answer with tolerance */
function checkAnswer(){
  if(!acceptingAnswer) return;
  acceptingAnswer = false;
  const user = answerInput.value.trim();
  const correct = (questions[idx].a || '').toString().trim();
  const sim = similarity(user, correct);
  const threshold = 0.72; // tolerance
  if(sim >= threshold){
    handleCorrect();
  } else {
    handleWrong(correct);
  }
  idx++;
  // short delay before next question to show feedback
  setTimeout(()=>{ showQuestion(); }, 900);
}

function handleCorrect(){
  score += 10;
  updateScore();
  resultEl.textContent = '✅ Benar! MasyaAllah!';
  resultEl.style.color = 'var(--success)';
  applyAnimation('flash-success');
  playSound(sndCorrect);
  fireConfetti();
}

function handleWrong(correct){
  resultEl.innerHTML = `❌ Salah! Jawaban benar: <b>${escapeHtml(correct)}</b>`;
  resultEl.style.color = 'var(--danger)';
  applyAnimation('flash-wrong');
  playSound(sndWrong);
}

/* helper */
function updateScore(){
  scoreView.textContent = score;
}
function applyAnimation(cls){
  card.classList.remove('flash-success','flash-wrong');
  void card.offsetWidth;
  card.classList.add(cls);
  setTimeout(()=>{ card.classList.remove(cls); }, 900);
}
function playSound(el){
  try{ el.currentTime = 0; el.volume = 0.9; el.play().catch(()=>{}); }catch(e){}
}

/* shuffle */
function shuffleArray(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

/* confetti (simple circles) */
function fireConfetti(){
  for(let i=0;i<12;i++){
    const s = document.createElement('span');
    s.style.left = (40 + Math.random()*60) + '%';
    s.style.top = (10 + Math.random()*10) + '%';
    const size = (6 + Math.random()*10);
    s.style.width = size + 'px';
    s.style.height = size + 'px';
    const colors = ['#ff8a65','#ffd54f','#81c784','#4fc3f7','#bb86fc'];
    s.style.background = colors[Math.floor(Math.random()*colors.length)];
    s.style.transform = `translateY(0) rotate(${Math.random()*360}deg)`;
    s.style.animationDuration = (1 + Math.random()*0.8)+'s';
    confetti.appendChild(s);
    setTimeout(()=> s.remove(),1800);
  }
}

/* end game */
function endGame(){
  questionEl.textContent = '🌟 Kuis Selesai 🌟';
  answerRow.style.display = 'none';
  const total = questions.length * 10;
  const playerPart = playerName ? ('• ' + escapeHtml(playerName) + ' • ') : '';
  const message = score === total ? '🌈 Sempurna! Kamu luar biasa!' :
    score >= (total * 0.6) ? '✨ Bagus! Tetap semangat belajar Islam!' :
    '📖 Yuk lebih giat lagi mengenal Islam!';
  resultEl.innerHTML = `Skor Akhir ${playerPart}<b>${score}</b> dari ${total}<br><br>${message}`;
  progressText.textContent = `Selesai • ${questions.length} soal`;
  bgMusic.pause(); bgMusic.currentTime = 0;

  // allow starting again by changing Start button text (optional UX)
  startBtn.textContent = 'Mulai Lagi';
}

/* escape html helper for name display */
function escapeHtml(str){
  return String(str).replace(/[&<>"'`=\/]/g, function(s){ return ({'&':'&amp;','<':'&lt;', '>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'})[s];});
}

/* Reset button */
document.getElementById('resetBtn').addEventListener('click', ()=>{
  idx=0; score=0; playerNameInput.value=''; levelSelect.value='medium';
  answerRow.style.display='none'; scorebar.style.display='none';
  questionEl.textContent = 'Klik "Mulai" untuk memulai kuis.';
  resultEl.textContent = '';
  progressText.textContent = '';
  updateScore();
  bgMusic.pause(); bgMusic.currentTime = 0;
  startBtn.textContent = 'Mulai';
  acceptingAnswer = true;
});

/* ============================
   Payment modal handlers
   ============================ */
payBtn.addEventListener('click', ()=>{ payModal.classList.add('show'); payModal.setAttribute('aria-hidden','false'); });
closePay.addEventListener('click', ()=>{ payModal.classList.remove('show'); payModal.setAttribute('aria-hidden','true'); });
paidBtn.addEventListener('click', ()=>{
  supported = true;
  payModal.classList.remove('show');
  showToast('Terima kasih! Dukunganmu sangat berarti 🙏');
  localStorage.setItem('hamami_supported','true');
});

/* simple toast message */
function showToast(msg){
  const t = document.createElement('div');
  t.textContent = msg;
  t.style.position='fixed';
  t.style.right='20px';
  t.style.bottom='20px';
  t.style.padding='10px 14px';
  t.style.background='rgba(3,57,108,0.9)';
  t.style.color='white';
  t.style.borderRadius='8px';
  t.style.zIndex=9999;
  document.body.appendChild(t);
  setTimeout(()=> t.style.opacity='0',1800);
  setTimeout(()=> t.remove(),2400);
}

/* allow clicking outside modal to close */
payModal.addEventListener('click', (e)=>{ if(e.target === payModal){ payModal.classList.remove('show'); } });

/* optionally: restore 'supported' state */
if(localStorage.getItem('hamami_supported') === 'true'){ supported = true; }

/* Prevent autoplay blockers: background music starts only after Start button (user gesture) */
/* End of script */
</script>
</body>
</html>
